sap.ui.define(["sap/dashboard/controller/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/dashboard/utils/ExcelFileControl","sap/dashboard/model/Formatter","sap/ui/core/BusyIndicator","sap/m/Token"],function(e,t,s,o,a,r,n,l){"use strict";return e.extend("sap.dashboard.controller.Employee",{formatter:r,onInit(){const e=this.getOwnerComponent().getModel("empModel");this.getView().setModel(e,"oEmpModel");this.getView().addEventDelegate({onBeforeShow:function(e){if(e.direction==="back"){this.setPageTitle()}else this.setDefaultData()}.bind(this)})},setPageTitle(){const e=this.getOwnerComponent().getModel("mainModel");e.setProperty("/sPageTitle","Employees")},async setDefaultData(){const e=this.getView().getModel("oEmpModel");try{n.show(0);const t=`/api/users`;const s=await fetch(t);if(!s.ok){throw new Error(`HTTP error ${s.status}`)}const{users:o}=await s.json();if(!Array.isArray(o)){throw new Error("Invalid employee data format")}const a={Employees:o,sSelDesgKeys:[],sSelDeptKeys:[],sSelOrgKeys:[],sSelRoleKeys:[],sSelGender:0,count:o.length,aAllDesg:[],aAllDept:[],aAllOrg:[],aAllRole:[]};e.setData(a);this.getEmpProperties("/aAllDesg","company","title");this.getEmpProperties("/aAllDept","company","department");this.getEmpProperties("/aAllOrg","company","name");this.getEmpProperties("/aAllRole","role");this.onResetPress();e.updateBindings(true)}catch(e){this.backToDashboard("Employee data load failed.",e.message)}finally{n.hide()}},resetFilterData(){const e=this.getView().getModel("oEmpModel");e.setProperty("/sSelDesgKeys",[]);e.setProperty("/sSelDeptKeys",[]);e.setProperty("/sSelOrgKeys",[]);e.setProperty("/sSelRoleKeys",[]);e.setProperty("/sSelGender",0);this.resetMITokens();if(this._oValueHelp){this.getView().byId("idOrgSelDialog").clearSelection()}},getEmpProperties(e,t,s){const o=this.getView().getModel("oEmpModel");const a=o.getProperty("/Employees");const r=new Set;const n=[];for(const e of a){const o=s?e[t]?.[s]:e[t];if(typeof o==="string"&&o.length>0){const e=o.charAt(0).toUpperCase()+o.slice(1);if(!r.has(e)){r.add(e);n.push({key:e,text:e})}}}o.setProperty(e,n)},onFilterSearch(){const e=this.getView().byId("idEmpTable");const o=this.getView().getModel("oEmpModel");const a=o.getProperty("/sSelDesgKeys");const r=o.getProperty("/sSelDeptKeys");const l=o.getProperty("/sSelOrgKeys");const i=o.getProperty("/sSelRoleKeys");const d=o.getProperty("/sSelGender");try{n.show(0);let p=[];if(a.length>0){a.map(e=>p.push(new t({path:"company/title",operator:s.EQ,value1:e})))}if(r.length>0){r.map(e=>p.push(new t({path:"company/department",operator:s.EQ,value1:e})))}if(i.length>0){i.map(e=>p.push(new t({path:"role",operator:s.EQ,value1:e})))}if(l.length>0){l.map(e=>p.push(new t({path:"company/name",operator:s.EQ,value1:e})))}if(d){p.push(new t({path:"gender",operator:s.EQ,value1:d===1?"male":"female"}))}e.getBinding("items").filter(p);o.setProperty("/count",e.getBinding("items").getAllCurrentContexts().length)}catch(e){this.showMessageBox("An unexpected error occcured.\n\n Error:\n "+e.message)}finally{n.hide()}},onTableItemSelect(e){const t=e.getSource().getBindingContextPath();const s=t.split("/")[2];this.getNavContainer().to("idEmpDetails",{id:s})},async onSortPress(){this._oSortDialog??=await this.loadFragment({name:"sap.dashboard.fragment.SortDialog"});this._oSortDialog.open()},handleConfirm(e){const t=this.getView().byId("idEmpTable");const s=e.getParameter("sortDescending");const a=e.getParameter("sortItem");if(a){const e=a.getProperty("text");let r="company/";switch(e){case"Name":r="firstName";break;case"Designation":r+="title";break;case"Organization":r+="name";break;default:r+=e.toLowerCase();break}const n=new o(r,s);t.getBinding("items").sort(n)}},onDownloadPress(){const e=this.getView().getModel("oEmpModel");const t=e.getProperty("/Employees");const s=t.map(e=>({...e,fullName:`${e.firstName} ${e.maidenName} ${e.lastName}`,personalAddress:`${e.address.address} ${e.address.city} ${e.address.state} ${e.address.stateCode} ${e.address.postalCode}`,companyAddress:`${e.company.address.address} ${e.company.address.city} ${e.company.address.state} ${e.company.address.stateCode} ${e.company.address.postalCode}`}));a.downloadSpreadsheet("Employees.xlsx",true,"Emp",s)},resetTableData(){const e=this.getView().byId("idEmpTable");const t=e.getBinding("items");const s=this.getView().getModel("oEmpModel");t.aSorter=[];t.sort(null);t.aFilters=[];t.filter(null);s.setProperty("/count",e.getBinding("items").getAllCurrentContexts().length)},onResetPress(){n.show(0);this.resetFilterData();this.resetTableData();n.hide()},async onShowOrgValueHelp(){this._oValueHelp??=await this.loadFragment({name:"sap.dashboard.fragment.ValueHelpDialog",controller:this});this._oValueHelp.open()},onOrgF4DialogClose(e){const t=this.getView();const s=t.getModel("oEmpModel");const o=e.getParameter("selectedContexts");const a=t.byId("idOrgMCB");const r=a.getTokens();if(o){const e=[];if(o.length===0||r.length>0)this.resetMITokens();if(o.length>0){o.forEach(t=>{const o=s.getProperty(t.getPath()).text;e.push(o);return a.addToken(new l({text:o}))});s.setProperty("/sSelOrgKeys",e)}}},onOrgSearchDialog(e){const o=e.getParameter("value");const a=new t("text",s.Contains,o);e.getSource().getBinding("items").filter([a])},resetMITokens(){this.getView().byId("idOrgMCB").removeAllTokens()}})});
//# sourceMappingURL=Employee.controller.js.map