sap.ui.define(["sap/dashboard/controller/BaseController","sap/dashboard/model/Formatter","sap/dashboard/utils/ExcelFileControl","sap/ui/core/BusyIndicator"],function(t,e,o,s){"use strict";return t.extend("sap.dashboard.controller.Products",{formatter:e,onInit(){this.getView().addEventDelegate({onBeforeShow:function(t){if(t.direction==="back"){this.setPageTitle()}else this._onBeforeShow()}.bind(this)})},onAfterRendering(){const t=this.byId("idProductsTable");sap.ui.core.ResizeHandler.register(t,()=>{this._adjustVisibleRows()});this._adjustVisibleRows()},_onBeforeShow(){this.setDefaultData();this.getProducts();this.onResetTable()},setPageTitle(){const t=this.getOwnerComponent().getModel("mainModel");t.setProperty("/sPageTitle","Products")},setDefaultData(){const t={products:[]};const e=this.getOwnerComponent().getModel("productModel");e.setData(t);this.getView().setModel(e,"oProductModel")},async getProducts(){try{s.show(0);const t=this.getView().getModel("oProductModel");const e=`/api/products`;const o=await fetch(e);if(!o.ok){throw new Error(`HTTP error ${o.status}`)}const{products:r}=await o.json();const i=r.map(t=>({...t,rating:Number(t.rating.toFixed(1))}));if(!Array.isArray(i)){throw new Error("Invalid product data format")}t.setProperty("/products",i)}catch(t){this.backToDashboard("Unable to load products.",t.message)}finally{s.hide()}},onRowItemSelected(t){let e="";if(t.getId()==="press"){e=t.getParameter("row").getBindingContext("oProductModel").getPath().split("/")[2]}if(t.getId()==="cellClick"){e=t.getParameter("rowBindingContext")?.getPath().split("/")[2]||""}if(e!==""){this.getNavContainer().to("idProdDetails",{id:Number(e)+1})}},onResetTable(){const t=this.getView().byId("idProductsTable");t.getBinding().aSorter=[];t.getBinding().sort(null);t.getColumns().forEach(e=>{t.filter(e,null);e.setSorted(false);e.setSortOrder("None")})},onDownloadSelected(){this.joinValues();o.downloadSpreadsheet("Products.xlsx",false,"Products",this.getView().getModel("oProductModel").getProperty("/products"))},joinValues(){const t=this.getView().getModel("oProductModel");const e=t.getProperty("/products");const o=e.map(t=>({...t,prodDim:t.dimensions.width+" x "+t.dimensions.height+" x "+t.dimensions.depth+" cm",images:t.images.join("; "),tags:t.tags.join("; ")}));t.setProperty("/products",o)},_adjustVisibleRows(){const t=this.byId("idProductsTable");const e=t.getProperty("rowHeight");const o=Math.round((window.innerHeight-220)/e);t.setProperty("visibleRowCount",o)}})});
//# sourceMappingURL=Products.controller.js.map