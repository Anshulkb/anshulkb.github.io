sap.ui.define(["sap/dashboard/controller/BaseController","sap/m/MessageToast","sap/dashboard/utils/ExcelFileControl","sap/m/MessageBox","sap/ui/core/Fragment","sap/dashboard/model/Formatter"],function(e,t,o,s,r,a){"use strict";return e.extend("sap.dashboard.controller.Master",{formatter:a,onInit(){const e=this.getOwnerComponent().getModel("masterModel");this.getView().setModel(e,"oMasterModel");this.getView().addEventDelegate({onBeforeShow:function(){this.setDefaultData()}.bind(this)})},setDefaultData(){const e=this.getView().getModel("oMasterModel");const t={showFilter:true,sSelKey:"",showUpload:false,filePath:"",uploadBtnEnable:false,showTable:false,count:0,scrollHeight:"0px",tableData:[],aErrors:[],oSelItem:{},sSelItemPath:"",oRichContent:"",sDialogTitle:""};e.setData(t)},resetTableSection(){const e=this.getView().getModel("oMasterModel");e.setProperty("/tableData",[]);e.setProperty("/count",0);e.setProperty("/showTable",false)},resetUploadSection(){const e=this.getView().getModel("oMasterModel");e.setProperty("/showUpload",true);e.setProperty("/filePath","");e.setProperty("/uploadBtnEnable",false)},resetBoth(){this.resetTableSection();this.resetUploadSection()},onSelectionChange(e){this.resetBoth()},async openErrorDialog(){this.oErrorDialog??=await this.loadFragment({name:"sap.dashboard.fragment.ExcelErrorDialog"});this.oErrorDialog.open()},onCloseDialog(){const e=this.getView().getModel("oMasterModel");e.setProperty("/filePath","");e.setProperty("/uploadBtnEnable",false);this.oErrorDialog.close()},onRecordCancelPress(){var e=this;s.warning("All record(s) will be removed. Are you sure?",{actions:[s.Action.OK,s.Action.CANCEL],emphasizedAction:s.Action.OK,onClose:function(t){if(t==="OK"){e.resetBoth()}}})},onRecordSavePress(){var e=this;const t=e.getView().getModel("oMasterModel");const o=t.getProperty("/tableData");const r=o.filter(e=>e.isDeleted!=="X");s[r.length>0?"success":"error"](r.length>0?"All record(s) have been saved successfully.":"Unable to save. No record found.",{onClose:function(){e.resetBoth()}})},onDeletePress(){const e=this.getView().getModel("oMasterModel");const o=this.getTableId(e.getProperty("/sSelKey"));const s=this.getView().byId(o);const r=s.getSelectedContextPaths();if(r.length<1){t.show("No item(s) selected for deletion.");return}r.forEach(t=>{e.getProperty(t).isDeleted="X"});t.show("Selected item(s) deleted successfully.");this.updateCount();this.resetTableSelection();e.updateBindings(true)},updateCount(){const e=this.getView().getModel("oMasterModel");const t=e.getProperty("/tableData").filter(e=>e.isDeleted!=="X").length;e.setProperty("/count",t)},onTemplateDownload(){const e=this.getView().getModel("oMasterModel");const t=e.getProperty("/sSelKey");o.downloadSpreadsheet((t==="E"?"Employees":"Products")+"Template.xlsx",false,t==="E"?"Emp":"Products")},onTypeMismatch(e){const t=e.getParameter("fileName");const o=e.getParameter("fileType");this.showMessageBox("error","File- "+t+" is of type- "+o+". Please upload either .xlsx or .csv files only.")},onFileUploadEvent(e){const t=new FileReader;const o=this.getView().getModel("oMasterModel");let s;try{sap.ui.core.BusyIndicator.show(0);if(e.getId()==="change"){s=e.getParameter("files")[0];if(s){o.setProperty("/file",s);this.resetTableSection();t.onloadend=()=>{o.setProperty("/uploadBtnEnable",true)}}else{o.setProperty("/filePath",o.getProperty("/file").name)}}if(e.getId()==="press"){s=o.getProperty("/file");t.onload=e=>{this.handleUploadedFile(e.target.result)}}if(s){t.readAsArrayBuffer(s)}}catch(e){this.showMessageBox("error",String(e))}finally{sap.ui.core.BusyIndicator.hide()}},handleUploadedFile(e){const t=this.getView().getModel("oMasterModel");const s=t.getProperty("/sSelKey")==="E"?"Employees":"Products";const r=new Uint8Array(e);const a=XLSX.read(r,{type:"array"});const i=a.SheetNames[0];const l=a.Sheets[i];const n=XLSX.utils.sheet_to_json(l,{header:1});const d=o.validateData(n,s);if(d==="Success"){const e=o.formatData(n,s);t.setProperty("/tableData",e);t.setProperty("/showTable",true);t.setProperty("/scrollHeight",window.innerHeight-330+"px");t.setProperty("/uploadBtnEnable",false);this.updateCount();this.bindTableFragment(s)}else{t.setProperty("/aErrors",d);this.openErrorDialog()}},async bindTableFragment(e){const t=this.getView().byId("idMasterScroll");const o="sap.dashboard.fragment.master."+e+"Table";if(t.getContent().length>0){this.destroyTables();t.removeAllContent()}r.load({id:this.getView().getId(),name:o,controller:this}).then(e=>t.addContent(e))},onEditPress(){const e=this.getView().getModel("oMasterModel");const o=this.getTableId(e.getProperty("/sSelKey"));const s=this.getView().byId(o);const r=s.getSelectedContextPaths();if(r.length>1){this.resetTableSelection();this.showMessageBox("error","Please select one row at a time to edit.");return}else if(r.length===1){const t=JSON.parse(JSON.stringify(e.getProperty(r[0])));e.setProperty("/oSelItem",t);e.setProperty("/sSelItemPath",r[0]);e.setProperty("/sDialogTitle","Edit Details");this.openEditDialog()}else{t.show("Please select a row to edit details.")}},onToggleFilterVisible(){const e=this.getView().getModel("oMasterModel");const t=e.getProperty("/showFilter");e.setProperty("/showFilter",!t);const o=t?window.innerHeight-160:window.innerHeight-330;e.setProperty("/scrollHeight",o+"px");e.updateBindings(true)},openEditDialog(){this.openDialog("_oEditDialog","sap.dashboard.fragment.master.EditDialog")},async openDialog(e,t){this[e]??=await this.loadFragment({name:t,controller:this});this[e].open()},onCloseEditDialog(){this.resetTableSelection();this._oEditDialog.close()},onSaveEditDialog(){const e=this.getView().getModel("oMasterModel");const t=this.trimValues(e.getProperty("/oSelItem"));const o=e.getProperty("/sSelItemPath");const s=this.getTableId(e.getProperty("/sSelKey"));const r=this.getView().byId(s);e.setProperty(o,t);e.updateBindings(true);r.scrollToIndex(Number(o.split("/")[2]));this.onCloseEditDialog()},onRowBtnPress(e){const t=this.getView().getModel("oMasterModel");const o=e.getSource().getProperty("icon").split("//")[1];const s=e.getSource().getParent().getBindingContextPath();let r="";switch(o){case"bar-code":r="Barcode";break;case"qr-code":r="QR Code";break;case"image-viewer":r="Images";break;case"picture":r="Thumbnail";break}const a=s+"/"+r;const i=t.getProperty(a);const l={sRichConDetail:i,sRichConTitle:r,sItemPath:a};t.setProperty("/oRichContent",l);this.openRichContentDialog()},openRichContentDialog(){this.openDialog("_oRichDialog","sap.dashboard.fragment.master.EditRichContentDialog")},resetTableSelection(){const e=this.getView().getModel("oMasterModel");const t=this.getTableId(e.getProperty("/sSelKey"));const o=this.getView().byId(t);o.removeSelections();o.setSelectedContextPaths([])},trimValues(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,typeof t==="string"?t.trim():t]))},onRichDialogClose(){this._oRichDialog.close()},onChgRichDetails(e){const t=this.getView().getModel("oMasterModel");t.setProperty("/oRichContent/sRichConDetail",e.getParameter("value"))},onRichDialogSave(){const e=this.getView().getModel("oMasterModel");const t=e.getProperty("/oRichContent/sItemPath");e.setProperty(t,e.getProperty("/oRichContent/sRichConDetail"));e.updateBindings(true);this.onRichDialogClose()},destroyTables(){if(sap.ui.getCore().byId("idMaster--idMasterProdTable"))sap.ui.getCore().byId("idMaster--idMasterProdTable").destroy();if(sap.ui.getCore().byId("idMaster--idMasterEmpTable"))sap.ui.getCore().byId("idMaster--idMasterEmpTable").destroy()},getTableId(e){return e==="E"?"idMasterEmpTable":"idMasterProdTable"},onAddPress(){const e=this.getView().getModel("oMasterModel");const t=e.getProperty("/tableData").length;const o=e.getProperty("/sSelKey");const s={employee:{"Employee ID":t+1,Name:"",Age:"",Gender:"",Email:"","Phone Number":"","Date of Birth":"","Blood Group":"",Address:"",Country:"",SSN:"",Role:"",Designation:"",Department:"",Company:"","Company Address":"",isDeleted:""},products:{"Product Name":"",Description:"",Brand:"",Category:"",Price:"",Discount:"",Rating:"",Stock:"",Tags:"","Stock keeping unit":"",Weight:"","Dimensions (WxHxD)":"","Warranty Details":"","Shipping Information":"",Availability:"","Return Policy":"","Minimum Order Quantity":"",Barcode:"","QR Code":"",Images:"",Thumbnail:"",isDeleted:""}};this.resetTableSelection();e.setProperty("/oSelItem",o==="E"?s.employee:s.products);e.setProperty("/sSelItemPath","/tableData/"+t.toString());e.setProperty("/sDialogTitle","Add Details");this.openEditDialog()}})});
//# sourceMappingURL=Master.controller.js.map