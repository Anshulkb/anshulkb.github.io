sap.ui.define(["sap/dashboard/controller/BaseController","sap/dashboard/model/Formatter","sap/ui/core/BusyIndicator"],function(t,e,o){"use strict";return t.extend("sap.dashboard.controller.Dashboard",{formatter:e,onInit(){this.getView().addEventDelegate({onBeforeShow:function(){this._onPatternMatched()}.bind(this)})},_onPatternMatched(){const t=this.getOwnerComponent().getModel("productModel");this.getView().setModel(t,"oProductModel");this.setDefaultData();this.getInitialData();this.setBusy("idColChart",true);this.setBusy("idDonutChart",true)},async getInitialData(){try{o.show(0);const t=this.getView().getModel("oProductModel");const e="/api/products";const s=await fetch(e);if(!s.ok){throw new Error(`HTTP error ${s.status}`)}const{products:r}=await s.json();if(!Array.isArray(r)){throw new Error("Invalid data format.")}const a=this.filterStock(r);const i=this.filterRange(r,"stock",10);t.setProperty("/products",r);t.setProperty("/filterByStock",a);t.setProperty("/filterByRange",i);this.setVizFrame(t);this.setColChart(t)}catch(t){this.showMessageBox("error","Unable to fetch details. "+t.message)}finally{o.hide()}},setDefaultData(){const t=this.getView().getModel("oProductModel");const e={filterByStock:"",filterByRange:"",count:"0",products:[],tableData:[]};t.setData(e)},filterStock(t){const e=t.filter(t=>t.availabilityStatus==="Low Stock");return this.sortData(e)},sortData(t){return t.sort((t,e)=>e.stock-t.stock)},filterRange(t,e,o){const s={};t.forEach(t=>{const r=t[e];let a;if(r===0){a=`Out of stock`}else{const t=Math.floor((r-1)/o)+1;const e=(t-1)*o+1;const s=t*o;a=`${e}-${s}`}if(!s[a]){s[a]=0}s[a]++});const r=Object.keys(s).map(t=>({range:t,count:s[t]}));r.sort((t,e)=>{const o=parseInt(t.range.split("-")[0],10);const s=parseInt(e.range.split("-")[0],10);return o-s});return r},tableShowByRange(t){let e=[];const o=this.getView().getModel("oProductModel").getProperty("/products");t.map(t=>{const s=t.data.Range;const r=parseInt(s.split("-")[0]);const a=parseInt(s.split("-")[1]);let i=false;if(s==="Out of stock")i=true;const l=o.filter(t=>t.stock>=r&&t.stock<=a||i&&t.stock===0);e.push(l)});return e},setVizFrame(t){const e=this.getView().byId("idDonutChart");e.setVizProperties({title:{text:"Low in stock"},plotArea:{dataLabel:{name:"Value Label",visible:true,type:"value"}},legend:{visible:true}});e.setModel(t);var o=this.getView().byId("idPopOver");o.connect(e.getVizUid());this.setBusy("idDonutChart",false)},setColChart(t){const e=this.getView().byId("idColChart");e.setVizProperties({title:{text:"Current stock"},plotArea:{dataLabel:{name:"Value Label",visible:true,type:"value",position:"top"}},legend:{visible:true},valueAxis:{title:{visible:false},label:{visible:false}},categoryAxis:{title:{visible:false},label:{visible:true}}});e.setModel(t);this.setBusy("idColChart",false)},onColumnItemSelect(){const t=this.getView().byId("idColChart").vizSelection();const e=this.tableShowByRange(t).flat();const o=this.getView().getModel("oProductModel");o.setProperty("/tableData",e);o.setProperty("/count",e.length)},onRemoveSelection(){var t=this.getView().byId("idColChart");t.vizSelection([],{clearSelection:true});oModel.setProperty("/count","0")},setBusy(t,e){this.getView().byId(t).setBusy(e)}})});
//# sourceMappingURL=Dashboard.controller.js.map