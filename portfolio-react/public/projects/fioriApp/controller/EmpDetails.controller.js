sap.ui.define(["sap/dashboard/controller/BaseController","sap/m/MessageBox","sap/dashboard/model/Formatter","sap/ui/core/BusyIndicator"],function(e,t,s,o){"use strict";return e.extend("sap.dashboard.controller.EmpDetails",{formatter:s,onInit(){this.getView().addEventDelegate({onBeforeShow:function(e){this.getOwnerComponent().getModel("mainModel").setProperty("/sPageTitle","Employee Details");this.setDefaultData();this.getEmpDetails(e.data.id)}.bind(this)})},setDefaultData(){const e=this.getOwnerComponent().getModel("empDetailModel");const t={details:{},isEditing:false,isDataModified:false,newDetails:{},isModified:false,aErrors:[]};e.setData(t);this.getView().setModel(e,"detailsModel")},async getEmpDetails(e){try{const t=this.getView().getModel("detailsModel");o.show(0);const s=`/api/users?id=${e}`;const i=await fetch(s);if(!i.ok){throw new Error(`HTTP error ${i.status}`)}const a=await i.json();if(typeof a!=="object"){throw new Error(`Invalid format for employee details.`)}t.setProperty("/details",a)}catch(e){t.error("Unable to fetch Employee details. "+e.message,{onClose:()=>{this.onBackPress()}})}finally{o.hide()}},onBackPress(){this.getView().getModel("detailsModel").setData({});this.getNavContainer().back()},onClickEdit(){const e=this.getView().getModel("detailsModel");const t=e.getProperty("/details");e.setProperty("/isEditing",true);e.setProperty("/newDetails",JSON.parse(JSON.stringify(t)))},onClickSave(){const e=this.getView().getModel("detailsModel");const s=e.getProperty("/newDetails");const i=e.getProperty("/aErrors");if(i.length>0){this.showMessageBox("error","Please check all the entered values.");return}const a={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s})};try{o.show(0);fetch(`/api/users?id=${s.id}`,a).then(e=>e.json()).then(()=>{t.success("Data saved successfully.",{onClose:function(){e.setProperty("/isEditing",false);e.setProperty("/isModified",false);e.setProperty("/details",s);o.hide()}})})}catch(e){this.showMessageBox("error",String(e))}},onClickCancel(){const e=this.getView().getModel("detailsModel");const s=e.getProperty("/isModified");const o=e.getProperty("/details");if(s){t.warning("All unsaved changes will be lost",{actions:[t.Action.OK,t.Action.CANCEL],emphasizedAction:t.Action.OK,onClose:function(t){if(t==="OK"){e.setProperty("/isEditing",false);e.setProperty("/isModified",false);e.setProperty("/details",o)}}})}else e.setProperty("/isEditing",false)},onValueChange(e){const t=this.getView().getModel("detailsModel");const s=t.getProperty("/isModified");let o=t.getProperty("/aErrors");const i=["company","address"];const a=e.getSource().getBinding("value").getPath();const r=a.replace("newDetails","details");const n=e.getParameter("value").trim();const l=Number(n);const d=i.includes(a.split("/")[2])?a.split("/")[3]==="address"?a.split("/")[4]:a.split("/")[3]:a.split("/")[2];const c={postalCode:()=>!Number.isInteger(l)||l<=0||n.length!==5,stateCode:()=>n.length!==2,default:()=>n===""};const g=(c[d]||c.default)();if(g){if(!o.includes(a)){o.push(a)}}else{o=o.filter(e=>e!==a)}t.setProperty("/aErrors",o);if(!s&&n!==t.getProperty(r))t.setProperty("/isModified",true)}})});
//# sourceMappingURL=EmpDetails.controller.js.map