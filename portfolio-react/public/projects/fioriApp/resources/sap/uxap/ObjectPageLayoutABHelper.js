/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/library","sap/ui/base/Object","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/m/IconTabFilter","sap/m/IconTabHeader","sap/m/library","sap/uxap/ObjectPageSection"],function(t,e,r,o,n,a,i,s,c,u){"use strict";var g=c.TabsOverflowMode;var h=c.IconTabHeaderMode;var f=o.extend("sap.uxap._helpers.AB",{constructor:function(t){this._oObjectPageLayout=t;this._oObserver=new a(this._proxyStateChanges.bind(this))},getInterface:function(){return this}});f._focusSection=function(t,e){var r=t.getDomRef();if(r){r.focus(e)}};f.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout};f.prototype._getAnchorBar=function(){var t=this.getObjectPageLayout(),e=t.getAggregation("_anchorBar"),r=t.getUpperCaseAnchorBar();if(!e){e=new s({id:t.getId()+"-anchBar",tabsOverflowMode:g.StartAndEnd,backgroundDesign:n.escapeSettingsValue(t.getBackgroundDesignAnchorBar()),mode:h.Inline});e.attachSelect(function(e){var r=e.getParameter("key");this._moveFocusOnSection(r);t.onAnchorBarTabPress(r)}.bind(this));e.addEventDelegate({onAfterRendering:function(){t._adjustTitlePositioning();this._clearAnchorBarFixedHeight(e)}.bind(this)});if(r){e.addStyleClass("sapUxAPAnchorBarUpperCase")}this.getObjectPageLayout().setAggregation("_anchorBar",e,true)}return e};f.prototype._fixAnchorBarHeight=function(t){var e=t.getDomRef()?.parentNode;if(e){e.style.height=e.clientHeight+"px"}};f.prototype._clearAnchorBarFixedHeight=function(t){var e=t.getDomRef()?.parentNode;if(e){e.style.height="auto"}};f.prototype._setLandmarkInfo=function(t){this._oLandmarkInfo=t;this._applyAriaAttributes()};f.prototype._applyAriaAttributes=function(){var t=this._getAnchorBar().$(),o=this.getObjectPageLayout(),n=o._formatLandmarkInfo(this._oLandmarkInfo,"Navigation"),a=e.getResourceBundleFor("sap.uxap");if(n.role){t.attr("role",n.role)}else if(n.role===""){t.removeAttr("role")}if(n.label){t.attr("aria-label",n.label)}else if(this._oLandmarkInfo?.getNavigationRole()!==r.AccessibleLandmarkRole.None){t.attr("aria-label",a.getText("NAVIGATION_ROLE_DESCRIPTION"))}};f.prototype._buildAnchorBar=function(){var t=this.getObjectPageLayout(),e=this._getAnchorBar(),r=t.getUpperCaseAnchorBar();this.resetControl();this._oObserver.disconnect();t._getVisibleSections().forEach(function(o){var a=e.getId()+"-"+o.getId()+"-anchor",s=new i(a,{text:n.escapeSettingsValue(o._getTitle()),key:o.getId(),iconColor:n.escapeSettingsValue(o.getAnchorBarButtonColor())}),c=o._getVisibleSubSections();this._setupCustomButtonForwarding(o,s,r);if(t.getShowAnchorBarPopover()){if(c.length>1){c.forEach(function(t){var r=e.getId()+"-"+t.getId()+"-anchor",o=new i(r,{text:n.escapeSettingsValue(t.getTitle()),key:t.getId()});s.addItem(o);this._setupCustomButtonForwarding(t,o)},this)}else if(c.length===1&&!o.getCustomAnchorBarButton()&&c[0].getTitle()?.trim()){this._setupCustomButtonForwarding(c[0],s,r)}}e.addItem(s)},this);t.setAggregation("_anchorBar",e)};f.prototype._setupCustomButtonForwarding=function(t,e,r){var o=t.getCustomAnchorBarButton();if(!o){return}e.setText(o.getText());e.setIcon(o.getIcon());this._oObserver.observe(o,{properties:true});this._getAnchorBar().attachSelect(function(t){this._forwardPressToCustomButton(t.getParameter("item"))},this)};f.prototype._forwardPressToCustomButton=function(e){var r=e.getKey(),o=t.getElementById(r),n=o?.getCustomAnchorBarButton();if(n){n.firePress()}};f.prototype.resetControl=function(){var t=this._getAnchorBar();this._fixAnchorBarHeight(t);t.destroyItems()};f.prototype.selectAnchorForSection=function(t){var e=sap.ui.getCore().byId(t),r;if(!e){return}r=e.isA("sap.uxap.ObjectPageSubSection");if(r){t=e.getParent().getId()}this._getAnchorBar().setSelectedKey(t)};f.prototype._setAnchorButtonsTabFocusValues=function(t){var e=this._getAnchorBar().getItems(),r,o="0",n="-1",a="tabIndex";e.forEach(function(e){r=e.$();if(e.getKey()===t){r.attr(a,o)}else{r.attr(a,n)}})};f.prototype._moveFocusOnSection=function(e){var r=t.getElementById(e),o,n,a={preventScroll:true},i;if(!r){return}if(!r.isActive()){i={onAfterRendering:function(){r.removeEventDelegate(i);f._focusSection(r,a)}};r.addEventDelegate(i);return}o=u._getClosestSection(r);n=this._getAnchorBar().getItems().find(t=>t.getKey()===o.getId());if(document.activeElement!==n.getDomRef()){i={onfocusin:function(){n.removeEventDelegate(i);f._focusSection(r,a)}};n.addEventDelegate(i)}f._focusSection(r,a)};f.prototype._proxyStateChanges=function(t){var e=t.object,r=e.getParent(),o=this._findAnchorForSectionBase(r),n=t.name,a=t.current,i="set"+p(n);if(o){o[i].call(o,a)}};f.prototype._findAnchorForSectionBase=function(t){var e=t?.getId(),r=this._getAnchorBar(),o=r.getItems(),n,a=function(t){return t.some(function(t){if(t.getKey()===e){n=t;return true}return a(t.getItems())})};a(o);return n};function p(t){return t.substring(0,1).toUpperCase()+t.substring(1)}return f});
//# sourceMappingURL=ObjectPageLayoutABHelper.js.map