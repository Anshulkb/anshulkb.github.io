/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/ui/export/ExportUtils"],function(e,r){"use strict";var t="sap/ui/export/provider/DataProviderBase",n="sap/ui/export/js/XLSXBuilder",o="sap/ui/export/js/libs/JSZip3";var i={execute:function(i,a){function s(e){if(e instanceof MessageEvent&&e.data){e=e.data}if(typeof a==="function"){a(e)}}function c(e,r){s({progress:true,fetched:e||0,total:r||0})}function u(e){s({error:e.message||e})}function l(e){s({finished:true,spreadsheet:e})}function f(){let e;let r;function a(t,n){r=t.getDataConverter(i);e=new n(i.workbook.columns,i.workbook.context,i.workbook.hierarchyLevel,i.customizing);var o=i.dataSource.data||[];var a=o.length;var s=r(o.slice());e.append(s);c(a,a);e.build().then(l)}sap.ui.require([t,n,o],a);return{cancel:l}}function p(){let e,r;function a(t,n){var o=new t(i);e=new n(i.workbook.columns,i.workbook.context,i.workbook.hierarchyLevel,i.customizing);r=o.requestData(s)}function s(r){if(r.error||typeof r.error==="string"){u(r.error);return}e.append(r.rows);c(r.fetched,r.total);if(r.finished){e.build().then(l)}}function f(){r.cancel();l()}sap.ui.require([t,n,o],a);return{cancel:f}}function d(){let t;const n={};var o=function(){t.postMessage({cancel:true});l()};function a(e){const{promise:r,resolve:t,reject:n}=Promise.withResolvers();const o=new Worker(e);const i=e=>{o.terminate();n(e)};const a=e=>{if(e.data.initialized){o.removeEventListener("message",a);o.removeEventListener("error",i);o.addEventListener("message",s);o.addEventListener("error",u);t(o)}};o.addEventListener("message",a);o.addEventListener("error",i);return r}function c(){e.warning("Direct worker is not allowed. Load the worker via Blob.");const r=`self.origin = "${n.base}"; importScripts("${n.src}");`;const t=window.URL.createObjectURL(new Blob([r]));return a(t)}async function f(){let e;try{e=await a(n.src)}catch(r){e=await c()}return e}function d(){e.warning("Blob worker is not allowed. Use in-process export.");o=p(i).cancel}async function w(){try{t=await f();t.postMessage(i)}catch(e){d()}}n.base=r.normalizeUrl(sap.ui.require.toUrl("sap/ui/export/js/"));n.src=`${n.base}SpreadsheetWorker.js`;w();return{cancel:()=>{o()}}}if(i.dataSource.type==="array"){return f()}else if(i.worker===false){return p()}else{return d()}}};return i},true);
//# sourceMappingURL=SpreadsheetExport.js.map