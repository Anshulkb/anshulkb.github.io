<mvc:View
    xmlns="sap.m"
    xmlns:layout="sap.ui.layout"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    controllerName="sap.dashboard.controller.Dashboard"
    xmlns:mvc="sap.ui.core.mvc"
>
    <Page
        enableScrolling="false"
        showHeader="false"
        id="dashboard"
    >
        <layout:Splitter
            height="99%"
            orientation="Vertical"
            class="paddingTiny"
        >
            <layout:Splitter>
                <layout:layoutData>
                    <layout:SplitterLayoutData size="50%" />
                </layout:layoutData>
                <layout:contentAreas>
                    <layout:FixFlex>
                        <layout:flexContent>
                            <viz:VizFrame
                                id="idColChart"
                                uiConfig="{applicationSet:'fiori'}"
                                height='100%'
                                width="100%"
                                vizType='column'
                                selectData="onColumnItemSelect"
                                deselectData="onColumnItemSelect"
                            >
                                <viz:dataset>
                                    <viz.data:FlattenedDataset
                                        data="{oProductModel>/filterByRange}"
                                    >
                                        <viz.data:dimensions>
                                            <viz.data:DimensionDefinition
                                                name="Range"
                                                value="{range}"
                                            />
                                        </viz.data:dimensions>
                                        <viz.data:measures>
                                            <viz.data:MeasureDefinition
                                                name="Stock"
                                                value="{count}"
                                            />
                                        </viz.data:measures>
                                    </viz.data:FlattenedDataset>
                                </viz:dataset>

                                <viz:feeds>
                                    <viz.feeds:FeedItem
                                        id='valueAxisFeed'
                                        uid="valueAxis"
                                        type="Measure"
                                        values="Stock"
                                    />
                                    <viz.feeds:FeedItem
                                        id='categoryAxisFeed'
                                        uid="categoryAxis"
                                        type="Dimension"
                                        values="Range"
                                    />
                                </viz:feeds>
                            </viz:VizFrame>
                        </layout:flexContent>
                    </layout:FixFlex>
                </layout:contentAreas>
            </layout:Splitter>
            <layout:Splitter>
                <layout:layoutData>
                    <layout:SplitterLayoutData size="auto" />
                </layout:layoutData>
                <layout:contentAreas>
                    <Table
                        items="{ path: 'oProductModel>/tableData'}"
                        autoPopinMode="true"
                        contextualWidth="Auto"
                    >
                        <headerToolbar>
                            <OverflowToolbar>
                                <Title
                                    text="{i18n>product}s ({= ${oProductModel>/count} === 0 ? '0' : ${oProductModel>/count}})"
                                    level="H2"
                                />
                                <ToolbarSpacer />

                                <Button
                                    icon="sap-icon://reset"
                                    tooltip="{i18n>reset}"
                                    press="onRemoveSelection"
                                />
                            </OverflowToolbar>
                        </headerToolbar>
                        <noData>
                            <Text text="{i18n>overviewEmptyTable}" />
                        </noData>
                        <columns>
                            <Column
                                width="15rem"
                                importance="High"
                            >
                                <Text text="{i18n>product}" />
                            </Column>
                            <Column
                                width="5rem"
                                importance="High"
                            >
                                <Text text="{i18n>stock}" />
                            </Column>
                            <Column
                                width="9rem"
                                importance="Low"
                            >
                                <Text text="{i18n>brand}" />
                            </Column>
                            <Column
                                importance="Low"
                                width="10rem"
                            >
                                <Text text="{i18n>category}" />
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem vAlign="Middle">
                                <cells>
                                    <Text text="{oProductModel>title}" />
                                    <Text text="{oProductModel>stock}" />
                                    <Text text="{oProductModel>brand}" />
                                    <Text
                                        text="{path:'oProductModel>category' ,formatter:'.formatter.firstLetterCaps'}"
                                    />
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                    <layout:FixFlex id='chartFixFlex'>
                        <layout:flexContent>
                            <viz:VizFrame
                                id="idDonutChart"
                                uiConfig="{applicationSet:'fiori'}"
                                vizType='donut'
                                height="100%"
                                width="100%"
                            >
                                <viz:dataset>
                                    <viz.data:FlattenedDataset
                                        data="{oProductModel>/filterByStock}"
                                    >
                                        <viz.data:dimensions>
                                            <viz.data:DimensionDefinition
                                                name="Name"
                                                value="{title}"
                                            />
                                        </viz.data:dimensions>
                                        <viz.data:measures>
                                            <viz.data:MeasureDefinition
                                                name="Stock"
                                                value="{stock}"
                                            />
                                        </viz.data:measures>
                                    </viz.data:FlattenedDataset>
                                </viz:dataset>

                                <viz:feeds>
                                    <viz.feeds:FeedItem
                                        uid="size"
                                        type="Measure"
                                        values="Stock"
                                    />
                                    <viz.feeds:FeedItem
                                        uid="color"
                                        type="Dimension"
                                        values="Name"
                                    />
                                </viz:feeds>
                                <viz:dependents>
                                    <viz:Popover id="idPopOver" />
                                </viz:dependents>
                            </viz:VizFrame>
                        </layout:flexContent>
                    </layout:FixFlex>
                </layout:contentAreas>
            </layout:Splitter>
        </layout:Splitter>
    </Page>
</mvc:View>
